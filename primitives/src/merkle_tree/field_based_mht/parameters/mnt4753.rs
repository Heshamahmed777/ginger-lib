use algebra::{
    fields::mnt4753::Fr as MNT4753Fr,
    biginteger::BigInteger768,
    field_new,
};

use crate::{
    crh::poseidon::MNT4PoseidonHash,
    FieldBasedMerkleTreePrecomputedEmptyConstants,
};

// PoseidonHash("This represents an empty Merkle Root for a MNT4753PoseidonHash based Merkle Tree.") padded with 0s
pub const MNT4753_PHANTOM_MERKLE_ROOT: MNT4753Fr =
    field_new!(MNT4753Fr, BigInteger768([
        8534937690304963668,
        5486292534803213323,
        1720870611961422927,
        11405914840660719672,
        7162329517212056783,
        11658292353137306079,
        17490588101047840223,
        12735752881395833110,
        11735157047413601083,
        6658060155531600932,
        1470933043432945054,
        312822709740712
    ]));

pub const MNT4753_MHT_POSEIDON_PARAMETERS: FieldBasedMerkleTreePrecomputedEmptyConstants<'static, MNT4PoseidonHash> =
    FieldBasedMerkleTreePrecomputedEmptyConstants {
        nodes: &[
            field_new!(MNT4753Fr,BigInteger768([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])),
            field_new!(MNT4753Fr,BigInteger768([16176523673378133334, 16956778265158276239, 4733072280094522678, 4192433122035539299, 15174036148465069565, 1064698154771993694, 11910330977019062149, 6319782654186851533, 16700914731313914268, 5445268834830289758, 1400505001002362360, 471965325761536])),
            field_new!(MNT4753Fr,BigInteger768([4277889709792061947, 16378415495394357880, 7044435121910608910, 14821584290848291872, 7395794966562039924, 16993255131573590866, 5619183296459254929, 13099791189349530546, 10480178751052362035, 2637008226322547176, 3781718695868806314, 12315153018770])),
            field_new!(MNT4753Fr,BigInteger768([12602160878026473095, 6703218031846246807, 3261593422652552071, 5744898705605418863, 568988017168646903, 11287816066753693968, 10074855438408190401, 15629691871152873479, 15780837983413394866, 9677498205745683353, 2710763567607654741, 62078701997150])),
            field_new!(MNT4753Fr,BigInteger768([3953781730258530358, 6110249182111184881, 5451270732317761177, 6943311044605255929, 3250905642119052198, 499062261769816654, 10259239560863736633, 14722428766718467461, 1595932533524212605, 12636118867227484435, 2535281826946782271, 28256121815614])),
            field_new!(MNT4753Fr,BigInteger768([12881414061557326842, 2307157185518412145, 16729611732227341092, 13661588739810946674, 18234379091090570831, 13728387961021650531, 1569717769337480380, 3151613579174483992, 1013749114920705196, 18081081464301638855, 17662018612700913184, 270340369174749])),
            field_new!(MNT4753Fr,BigInteger768([3605040078201732329, 15148117684514223001, 2205284832938577511, 14243812222834942509, 4721805097502261162, 12477409373644239295, 2133828053265029846, 8064415567340640846, 9139665707130095289, 2327875196086669640, 7490804028311302854, 39972867252844])),
            field_new!(MNT4753Fr,BigInteger768([13474454514586827491, 10425256355538130430, 16532298926701769119, 6952341694048969702, 4310318211674876121, 17985109358262381251, 7018608422116534547, 856082501862907948, 10201142017622815327, 4014460796003869169, 18010264820431769424, 292492626559474])),
            field_new!(MNT4753Fr,BigInteger768([13139671956879947102, 11795592347454983858, 7434654901760918990, 15991845460188159262, 8926398827090641285, 11990848706687304309, 926869728656438786, 4306382339328932384, 7269461104939176981, 1807966305486065051, 4264822993380428385, 293851919357767])),
            field_new!(MNT4753Fr,BigInteger768([7342491680395881561, 4489070398956337739, 1841666804269854648, 6979644289443721867, 6071690188598067424, 3997963076382743365, 3039024652836142348, 14814384789583809377, 1655550027026311714, 9713495234097377698, 2137662669331280893, 88937546849400])),
            field_new!(MNT4753Fr,BigInteger768([16373180430190352304, 4568986638504379799, 11510087407464449489, 16156967732575703950, 6050766378378947199, 859918639245209489, 6772545515530587766, 13110119935032867725, 7036298432403266305, 17344570648793268650, 821472278359650501, 413286128211952])),
            field_new!(MNT4753Fr,BigInteger768([10064204450670869041, 6485002129695176050, 13703715585507433387, 6358528581148388798, 8317188422852594958, 16249587742229080712, 15320018320869903910, 6519053266577151375, 13012784699871617737, 5320294235171818985, 454727173294227562, 5938002571396])),
            field_new!(MNT4753Fr,BigInteger768([5970737698044827110, 12553390334279345905, 17425479610490698473, 10934643973186563254, 15507168698998809488, 12161816561081931432, 14261361224889855408, 16994719105388441699, 17735618555000182797, 9609548097148711049, 17046188423488746023, 179196001269934])),
            field_new!(MNT4753Fr,BigInteger768([16709709138701649262, 12385797615346539441, 15793702613532409439, 11792904936680731911, 12448525568586080213, 18093815366893683166, 17458183917083722104, 15386763209861070357, 15840640717629650353, 1633965272590164610, 6406553317189723786, 453724791849806])),
            field_new!(MNT4753Fr,BigInteger768([2251450467303238906, 18229227672555802069, 2321869528003277491, 5043025073640215091, 8897028974870798639, 1992482375368886049, 1127757339681285238, 4970155236198853509, 5531972124480915021, 11062705402253819529, 15409860081207635910, 63367562695789])),
            field_new!(MNT4753Fr,BigInteger768([12665956519007526801, 1843696063471531093, 4421617427066245380, 16793646830533228386, 9608384167236543090, 16246507232290209049, 8388997809959181075, 10840864805493139596, 8450266449020314034, 18230781272203046274, 14551001191227447302, 39411984747300])),
            field_new!(MNT4753Fr,BigInteger768([17645993219199470363, 4456989415638893456, 4408935425422831546, 11479469842080797658, 12461503208035377620, 8803849468867694413, 7077438435087789253, 18001987624227409493, 14865983638481701230, 12976208785697116336, 6171183493110737796, 275982657298262])),
            field_new!(MNT4753Fr,BigInteger768([12899372984440970302, 4799739196163719468, 18281200174184323078, 14946209440607152291, 18038633657381931669, 13067278118534518262, 5933725396271864440, 17619708040456630714, 2298350945899000737, 8542906148384703647, 4228741343160794490, 179821403404139])),
            field_new!(MNT4753Fr,BigInteger768([4909989095880468007, 17111380839816086128, 13050894464535600155, 17809974587333109512, 3086375548608236017, 4319641169843690011, 8065063935915414369, 473711108534546470, 16419368658227689488, 12529592002690167987, 13604515417941051506, 474131523927671])),
            field_new!(MNT4753Fr,BigInteger768([2169765295327214927, 12853779434032519714, 4188854069571610948, 11176715314675409911, 6762724088888884422, 17971049055147305269, 4462649898332426762, 6320507659953355380, 10630149020511712781, 7236213148398521505, 12209435975744724638, 169609105942177])),
            field_new!(MNT4753Fr,BigInteger768([4039022148289766684, 18287223727808800157, 5028272483573475465, 15052031213537407210, 4871429795110173763, 13614938552192121828, 12468252496702382358, 357389198149731327, 9783015964887059718, 7249799829448192, 15969956552103665981, 81227891365913])),
            field_new!(MNT4753Fr,BigInteger768([8605248520836760614, 7698601903285982577, 7884851945210851008, 11137343029012187974, 14941286058184996238, 8942300516617698513, 12939320316637942536, 1083599900484092912, 6146753984613830917, 8826262634545573139, 8688587480911778755, 260284710393087])),
            field_new!(MNT4753Fr,BigInteger768([7819867473996257895, 1163119882964275677, 11350473626422120371, 8626456057335088473, 14345605516748953137, 16749457994730221606, 16544765006115835698, 8298164333055185490, 4406983934583628718, 14285702076873139552, 5994563637574463256, 116897006820475])),
            field_new!(MNT4753Fr,BigInteger768([10594331094316413862, 70589505093706233, 5947914170501868337, 9672947291446030947, 10471508875756623171, 5885944209881926849, 12238184998651009858, 2356768587459654214, 1976222780735616667, 7837959657680688622, 15005043837627313635, 325697264245299])),
            field_new!(MNT4753Fr,BigInteger768([11667320706060706659, 4497687445765901980, 2058017719541602176, 12722409913033257750, 10570174209277577513, 8050204849865648454, 961757207376139324, 7111416262996090474, 7042025878446682219, 9563801595559695088, 7959547555032992673, 299817378928680])),
            field_new!(MNT4753Fr,BigInteger768([17875883576651124852, 12019580853957703123, 14052735765400810986, 12134502857846062868, 3932260060058116996, 7412890163800836041, 7364941959471116085, 13719981274545202396, 3896197460809059188, 10937048028897553703, 14723811072279331346, 153865728544816])),
            field_new!(MNT4753Fr,BigInteger768([6377003792482571837, 9388472707381902393, 16257705780321388021, 3660250735951570492, 6398042051117445808, 1214492883228958801, 6488083732806553102, 16343892194218810768, 10336715715449488978, 12278416360730941598, 15120896212829175083, 394513338866242])),
            field_new!(MNT4753Fr,BigInteger768([9245962539596129756, 11308784860300487285, 9743504241464063619, 2074639663493309096, 15871180161301662049, 6557679360035650783, 15143489300651627352, 9812097890750485822, 1244537599719308281, 10545958110682494900, 17248790119900992474, 249218627631122])),
            field_new!(MNT4753Fr,BigInteger768([11835214222516122436, 15764240437657974407, 6420372599378240894, 16652019220914568700, 7589938208001402659, 13631631940696103757, 11230090654519768203, 13440030055936664621, 14280625899794233793, 15100178106414451409, 16623067409628724177, 212213341437214])),
            field_new!(MNT4753Fr,BigInteger768([6011277968708967059, 639496817632482309, 5929013035997986788, 16843575660916066646, 1149777341859285338, 14658042833551766188, 7634621850133386722, 7001742147011157176, 7359717955614460602, 6888539823450308368, 17116969251913704728, 204877760505258])),
            field_new!(MNT4753Fr,BigInteger768([675673922872315140, 512129263392578794, 9798690560912251207, 7054764921560592919, 686766133538325336, 5178995292196027033, 6583362491349948775, 16058868603513050375, 12947923073962473868, 2752063852071387331, 12806379407361838115, 15307678462607])),
            field_new!(MNT4753Fr,BigInteger768([11094226676306026356, 892488786370986741, 5437666239468371688, 16672274046028921911, 9239873541740716904, 12705472627429935031, 7206833212006685522, 8231183089056512015, 10801086054025107055, 1571241152085700920, 9342851935948733002, 359062727739383])),
            field_new!(MNT4753Fr,BigInteger768([12626192863498559769, 4968852371277424393, 2530250434805537910, 16162102870268636043, 547272346507800090, 12183453615274424913, 8499797127502674163, 8056429342665427148, 7496571365272431209, 181055189816194176, 14815307604617191394, 102402652534269])),
            field_new!(MNT4753Fr,BigInteger768([13377265285437446591, 3352135748620234639, 13499357599871397619, 1538567981079493584, 16835432028939005585, 1489545390044353676, 5802843886319864877, 3744352011146277769, 10138325315351804883, 9706994107202364805, 6080057850105416814, 21683659967889])),
            field_new!(MNT4753Fr,BigInteger768([14676049290848132453, 2439091224842193539, 11542050736983134836, 4100153475221219504, 2196785088215953222, 17010857509769574328, 14064058056664542171, 11748564706229565562, 7464979168051417429, 6595033253934784911, 18169911910223096937, 215103939901774])),
            field_new!(MNT4753Fr,BigInteger768([17635318468772890277, 6352239780588639586, 10723339619007833446, 4893451802181675528, 4644556819212868158, 10153277421006788286, 9681039424445901541, 4852861664528550119, 8340680302631027082, 1123576236662129079, 16034785489282305855, 186509610595629])),
            field_new!(MNT4753Fr,BigInteger768([12625048523149826889, 5522016944643377594, 7699716105964784333, 18011247809484228968, 4314570080726502960, 4534820968063172891, 15750612471035961368, 16546982327248344102, 13106434188126237333, 2436901965804455265, 5509854058561642711, 235667917842447])),
            field_new!(MNT4753Fr,BigInteger768([15473980367787724738, 14437267393882795992, 8110764953514076111, 433491927694759431, 3501549144853175578, 4001144872122038393, 6285601585004779307, 7480052501517952400, 17706668432898352939, 17525543761380897562, 18262056004935591255, 100296896212791])),
            field_new!(MNT4753Fr,BigInteger768([13004537459536567505, 11536021368999062598, 11476994106473535335, 7501290503318089205, 1503497677790037124, 8571448125114677630, 2093681935226603521, 1783977282134180201, 815416671438766434, 14033390703273309148, 13863148357185408708, 151116486379211])),
            field_new!(MNT4753Fr,BigInteger768([11520390923272391174, 3700965319616748151, 16924840217636033521, 18866038153491911, 2401619975857281608, 15177168781119161934, 12160998724327471520, 9013888042188307789, 3884831131364280062, 4885763940431702386, 2558247536923573977, 230028098468810])),
            field_new!(MNT4753Fr,BigInteger768([10952132645556577918, 14768047366047066018, 16559210792506962762, 7202327027750626448, 569029245718616885, 6466881656623105602, 15350553108611606365, 4894926269159096183, 1368096661189637446, 14450950852108076518, 13525020817388864926, 256218987628845])),
            field_new!(MNT4753Fr,BigInteger768([11220546759813133736, 5574904932062982166, 1822072885686664942, 10305847449656783355, 786989818258593805, 8496531785376290371, 17372104123217289082, 11874517411562081834, 692404362408103552, 3619223599209338443, 7313814121803648884, 414498108514135]))
        ],
        merkle_arity: 2,
        max_height: 41,
    };

#[cfg(test)]
mod test {

    use algebra::{
        fields::mnt4753::Fr,
        FromBytes, Field, PrimeField, FpParameters
    };
    use crate::crh::{
        MNT4PoseidonHash, FieldBasedHash,
    };
    use super::{
        MNT4753_PHANTOM_MERKLE_ROOT, MNT4753_MHT_POSEIDON_PARAMETERS
    };

    #[ignore]
    #[test]
    fn generate_mnt4753_phantom_merkle_root(){
        let field_size_in_bytes = (Fr::size_in_bits() + (<Fr as PrimeField>::Params::REPR_SHAVE_BITS as usize))/8;
        let magic_string = b"This represents an empty Merkle Root for a MNT4753PoseidonHash based Merkle Tree.";

        let mut hash_input = Vec::new();
        hash_input.extend_from_slice(magic_string);
        for _ in magic_string.len()..field_size_in_bytes { hash_input.push(0u8) }
        let hash_input_f = Fr::read(hash_input.as_slice()).unwrap();

        let mut digest = MNT4PoseidonHash::init(None);
        digest.update(hash_input_f);
        assert_eq!(digest.finalize(), MNT4753_PHANTOM_MERKLE_ROOT);
    }

    #[ignore]
    #[test]
    fn generate_binary_mnt4753_mht_nodes() {
        let mut empty_node = MNT4753_MHT_POSEIDON_PARAMETERS.nodes[0].clone();
        assert_eq!(empty_node, Fr::zero());
        let mut digest = MNT4PoseidonHash::init(None);
        for node in MNT4753_MHT_POSEIDON_PARAMETERS.nodes {
            assert_eq!(node, &empty_node);
            empty_node = digest.update(empty_node).update(empty_node).finalize();
            digest.reset(None);
        }
    }
}
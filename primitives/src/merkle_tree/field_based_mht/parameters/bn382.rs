use algebra::{
    fields::bn_382::Fr as BN382Fr,
    biginteger::BigInteger384,
    field_new,
};

use crate::{
    crh::poseidon::BN382FrPoseidonHash,
    FieldBasedMerkleTreePrecomputedEmptyConstants,
};

// PoseidonHash("This represents an empty Merkle Root for a BN382PoseidonHash based Merkle Tree.")
pub const BN382_PHANTOM_MERKLE_ROOT: BN382Fr =
    field_new!(BN382Fr, BigInteger384([
        4838402151703393731,
        9090604893589195550,
        1731006251955805765,
        1348662098166494253,
        8636612641322414294,
        1080867906211844884
     ]));

pub const BN382_MHT_POSEIDON_PARAMETERS: FieldBasedMerkleTreePrecomputedEmptyConstants<'static, BN382FrPoseidonHash> =
    FieldBasedMerkleTreePrecomputedEmptyConstants {
        nodes: &[
            field_new!(BN382Fr, BigInteger384([0, 0, 0, 0, 0, 0])),
            field_new!(BN382Fr, BigInteger384([7656866901414484633, 746112822615100749, 7601280042858228528, 5224304567184829710, 7895665560846141156, 1177409539935880791])),
            field_new!(BN382Fr, BigInteger384([16746009839300921184, 8221636012081273229, 8426142801568098437, 10971458034243210321, 11004536799119092256, 2040586690470504156])),
            field_new!(BN382Fr, BigInteger384([5787496438651083061, 10047077754668161615, 16433349413637348384, 407401495867804800, 15810606202185305958, 1761881428018185788])),
            field_new!(BN382Fr, BigInteger384([7968044388045518621, 6248009887866425539, 4289616942176489807, 15321093876832345800, 2725865047056716505, 1732950049731668589])),
            field_new!(BN382Fr, BigInteger384([3102428176096575890, 2775162535672794500, 3976807359497015240, 12852767712135360595, 9784210995708567301, 840625114132575576])),
            field_new!(BN382Fr, BigInteger384([13007144068104212140, 11144452457276228744, 12957006493319707841, 11399573203482336775, 8430882949468246014, 1981180743657839280])),
            field_new!(BN382Fr, BigInteger384([8466854253483490213, 16705481697367038728, 6505622078883096213, 4641669833200480506, 2486865101083918595, 1685084560541215626])),
            field_new!(BN382Fr, BigInteger384([16630142507157854226, 7347635433146640691, 3133145791861444113, 2488811199488584889, 11303015617354428170, 2400441675995288364])),
            field_new!(BN382Fr, BigInteger384([3640758889821487515, 7827708533990641094, 11129403644031416403, 4274573211664433698, 8513355176144672014, 719182642697705045])),
            field_new!(BN382Fr, BigInteger384([4281681471806963510, 9417198883025518499, 3563344784791802184, 15550824779263880738, 5555609792870864123, 1967382033302781093])),
            field_new!(BN382Fr, BigInteger384([3755487902832728655, 220816362112441876, 14296236450828832530, 8196264562390474739, 9291846065048288668, 1315720037814226221])),
            field_new!(BN382Fr, BigInteger384([13930553465711804882, 7801319265467128675, 10435719425756966788, 5953421083498571976, 9186249279755200552, 632740537213896991])),
            field_new!(BN382Fr, BigInteger384([3202466002071106326, 4628788866803251461, 3658112465854789314, 5457441945477702785, 16896619001408246925, 1292901701137777899])),
            field_new!(BN382Fr, BigInteger384([3548054471253060547, 3769224829654314051, 5699084885090729102, 4736232644993018815, 9614983354264738727, 1827016063551439604])),
            field_new!(BN382Fr, BigInteger384([59107513274147392, 12526840942515471827, 13346093342686469822, 2436865477944241216, 14653225961850657501, 886757327367928194])),
            field_new!(BN382Fr, BigInteger384([15131754420729269626, 16681292400811305497, 11411876382217470378, 16215398627269059135, 1065475674708030616, 492280285476575679])),
            field_new!(BN382Fr, BigInteger384([4346581484294865802, 1427007491012820065, 6545142518026615220, 17932032531481057801, 11313734270985600180, 1531064513069240526])),
            field_new!(BN382Fr, BigInteger384([2111001086269417642, 3864004846011944230, 10504514138280632473, 2998182864531876039, 7392805848993346978, 7438219249955802])),
            field_new!(BN382Fr, BigInteger384([3805624671254247433, 8955779096445644131, 18089542233271366707, 14064458366561801439, 9399379789895903710, 1375357791947459609])),
            field_new!(BN382Fr, BigInteger384([6409175356641652225, 5785122952814051899, 10617148518585950746, 5633196789970268432, 3791225062039333926, 997730538954402756])),
            field_new!(BN382Fr, BigInteger384([4925017621521725142, 9059447965815343898, 6459027565950674274, 9280490252076030709, 8878376502588657660, 2436038212825865516])),
            field_new!(BN382Fr, BigInteger384([1135257525496828315, 6892541073494951474, 1408219894958805363, 13674674056634896648, 1908297025740904690, 1079010020563468502])),
            field_new!(BN382Fr, BigInteger384([15619868570067267146, 11214383196506476407, 545107622729835768, 9119383865271861283, 9210513851460393384, 2194533999985229993])),
            field_new!(BN382Fr, BigInteger384([13338036779937458081, 16557128829545984280, 12972436493008110738, 16758764007784827379, 7017334882860030381, 1982781176327983794])),
            field_new!(BN382Fr, BigInteger384([14117604664336038660, 11317666680040464138, 4476698800745993298, 2415033151467788778, 16155419910928009705, 2393375283647261054])),
            field_new!(BN382Fr, BigInteger384([11153777552586350712, 11982318147506205284, 2616724192771508001, 11704078433467158601, 15370105053347851142, 904684783013605222])),
            field_new!(BN382Fr, BigInteger384([11865476902610483514, 7533103992585490433, 14599525290681629871, 12661235534259121545, 15704487591334765296, 286092640071158752])),
            field_new!(BN382Fr, BigInteger384([3783015111462979022, 7677002088389775628, 8715786334100440689, 3266495372340037262, 6276549635350211302, 2176239174554498894])),
            field_new!(BN382Fr, BigInteger384([13709490862008468297, 13658229423157923655, 8874891351340254309, 9686601677870951312, 12160604513625993770, 1013539753424004922])),
            field_new!(BN382Fr, BigInteger384([14632640573233859023, 15313631859409796542, 14238587570377747348, 10179642407677293352, 18916855197360089, 1884460987776983571])),
            field_new!(BN382Fr, BigInteger384([4492678167392363627, 16096883990422110609, 5213890908811966560, 1867247942607186266, 5079573698464391499, 751379634194770616])),
            field_new!(BN382Fr, BigInteger384([1293646923945926283, 11100520505232413505, 14798527996209212966, 4897092174833132002, 13604298178423148677, 1172067536632554444])),
            field_new!(BN382Fr, BigInteger384([18382164912063535733, 6088220396911957509, 11969169537767302671, 7005168802964175435, 9499359400754004230, 1513110029479116038])),
            field_new!(BN382Fr, BigInteger384([3010512768972987010, 2583256881225483896, 18253562656965579810, 15726179594886994331, 6224521355642212551, 1418466162011594744])),
            field_new!(BN382Fr, BigInteger384([5426738579824425821, 4540391946916594573, 4819515255148920253, 7482505551118766857, 2406315471784483975, 1865998106318269681])),
            field_new!(BN382Fr, BigInteger384([9185082919781870409, 13089167745187314258, 16399057047607211130, 12085632002970769679, 16599800340072143748, 2046543254348929862])),
            field_new!(BN382Fr, BigInteger384([9251068450182194403, 3570859668125806394, 9833843406691174323, 12271544622641155424, 14940423236281919662, 905313811561956619])),
            field_new!(BN382Fr, BigInteger384([17277204703521399899, 12166137213126497180, 8616466578975193102, 1746803783712715059, 11740224580942482303, 171809732655458365])),
            field_new!(BN382Fr, BigInteger384([3956144950887927073, 7483059183550279790, 11106038923780062207, 13861397183386251719, 1393052653006273936, 749028084310468903])),
            field_new!(BN382Fr, BigInteger384([334817408926757103, 595553840109621179, 666912279678956282, 9088659000750731257, 4188708482129879646, 594518943285840455])),
        ],
        merkle_arity: 2,
        max_height: 41,
    };

#[cfg(test)]
mod test {

    use algebra::{
        fields::bn_382::Fr, Field,
    };
    use crate::crh::{
        BN382FrPoseidonHash, FieldBasedHash,
    };
    use super::{
        BN382_PHANTOM_MERKLE_ROOT, BN382_MHT_POSEIDON_PARAMETERS
    };

    //#[ignore]
    #[test]
    fn generate_bn382_phantom_merkle_root(){
        use algebra::ToConstraintField;

        let magic_string = b"This represents an empty Merkle Root for a BN382PoseidonHash based Merkle Tree.";
        let magic_string_as_fes = magic_string.to_field_elements().unwrap();

        let mut digest = BN382FrPoseidonHash::init(None);
        magic_string_as_fes.into_iter().for_each(|fe| { digest.update(fe); });
        assert_eq!(digest.finalize(), BN382_PHANTOM_MERKLE_ROOT);
    }

    //#[ignore]
    #[test]
    fn generate_binary_bn382_mht_nodes() {
        let mut empty_node = BN382_MHT_POSEIDON_PARAMETERS.nodes[0].clone();
        assert_eq!(empty_node, Fr::zero());
        let mut digest = BN382FrPoseidonHash::init(None);
        for node in BN382_MHT_POSEIDON_PARAMETERS.nodes {
            assert_eq!(node, &empty_node);
            empty_node = digest.update(empty_node).update(empty_node).finalize();
            digest.reset(None);
        }
    }
}


